<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Simplificado de Registro de Colegio - EDUGANA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <style>
        /* --- ESTILOS GENERALES DEL FORMULARIO --- */
        .container {
            margin-top: 30px;
            margin-bottom: 50px;
            max-width: 700px; /* Ancho para el formulario */
        }
        .vertical-buttons .control {
            margin-bottom: 10px; /* Espacio entre botones en vertical */
        }

        /* --- ESTILOS DE LA CABECERA CON GRADIENTE (Page-Header) --- */
        .page-header {
            margin-bottom: 2rem;
            /* Gradiente Morado a Azul */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border-radius: 0px 0px 12px 12px;
            padding: 2rem;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .page-header .title,
        .page-header .subtitle {
            color: white !important;
        }

        .page-header .icon {
            color: white;
        }

        .page-header .icon-text {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Puntos del usuario (Botón de puntos) */
        .user-points {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .user-points .icon {
            font-size: 1.5rem;
        }

        /* --- MEDIA QUERIES PARA RESPONSIVE DE CABECERA --- */
        @media screen and (max-width: 768px) {
            .page-header .level {
                display: block !important;
                text-align: center;
            }
            .page-header .level-left,
            .page-header .level-right {
                margin-bottom: 1rem;
                text-align: center;
            }
            .page-header .title.is-2 {
                font-size: 1.3rem;
            }
            .page-header .subtitle.is-5 {
                font-size: 0.95rem;
            }
            .page-header {
                padding: 1.25rem 1rem;
            }
            .page-header .icon-text {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
            }
            .user-points {
                font-size: 1rem;
                padding: 0.6rem 1.2rem;
                margin: 0 auto;
                display: flex;
                justify-content: center;
            }
        }
        @media screen and (max-width: 480px) {
            .page-header .title.is-2 {
                font-size: 1.1rem;
            }
            .page-header .subtitle.is-5 {
                font-size: 0.85rem;
            }
            .user-points {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
        }
    </style>
</head>
<body>
    
<div class="page-header">
    <div class="level">
        <div class="level-left">
            <div class="level-item">
                <div>
                    <h1 class="title is-2">
                        <span class="icon-text">
                            <span class="icon has-text-white mr-3">
                                <i class="fas fa-gift fa-lg"></i> </span>
                            <span>Nuevo Colegio</span>
                        </span>
                    </h1>
                    <p class="subtitle is-5 mt-2">EduGana</p>
                </div>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <div class="user-points">
                    <span class="icon">
                        <i class="fas fa-coins"></i>
                    </span>
                    <span id="userPoints"></span> <span></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="box">
        <h1 class="title is-3 has-text-centered has-text-primary"></h1>
        <hr>

        <form action="#" method="POST">

            <h2 class="title is-5 is-size-6-mobile mb-4">1. Identificación y Código</h2>
            <div class="columns is-multiline">
                
                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="id_colegio">ID de Colegio (Sistema)</label>
                        <div class="control has-icons-left">
                            <input class="input is-static" type="text" value="Automático" id="id_colegio" name="id_colegio" readonly>
                            <span class="icon is-small is-left"><i class="fas fa-key"></i></span>
                        </div>
                    </div>
                </div>

                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="nombre">Nombre del Colegio <span class="has-text-danger">*</span></label>
                        <div class="control has-icons-left">
                            <input class="input" type="text" placeholder="I.E.P. Ejemplo" id="nombre" name="nombre" required>
                            <span class="icon is-small is-left"><i class="fas fa-building"></i></span>
                        </div>
                    </div>
                </div>
                
                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="codigo">Código Modular / RUC <span class="has-text-danger">*</span></label>
                        <div class="control has-icons-left">
                            <input class="input" type="text" placeholder="Ej: 12345678901" id="codigo" name="codigo" required>
                            <span class="icon is-small is-left"><i class="fas fa-hashtag"></i></span>
                        </div>
                    </div>
                </div>

                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="tipo_colegio">Tipo de Gestión <span class="has-text-danger">*</span></label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select id="tipo_colegio" name="tipo_colegio" required>
                                    <option value="" disabled selected>Seleccione</option>
                                    <option value="publico">Público</option>
                                    <option value="privado">Privado</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <hr>

            <h2 class="title is-5 is-size-6-mobile mb-4">2. Ubicación Geográfica</h2>
            <div class="field">
                <label class="label" for="direccion">Dirección Completa <span class="has-text-danger">*</span></label>
                <div class="control has-icons-left">
                    <input class="input" type="text" placeholder="Av. Los Tulipanes 456" id="direccion" name="direccion" required>
                    <span class="icon is-small is-left"><i class="fas fa-map-marker-alt"></i></span>
                </div>
            </div>

            <div class="columns">
                <div class="column">
                    <div class="field">
                        <label class="label" for="departamento">Departamento <span class="has-text-danger">*</span></label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Ej: Piura" id="departamento" name="departamento" required>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="field">
                        <label class="label" for="provincia">Provincia <span class="has-text-danger">*</span></label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Ej: Sullana" id="provincia" name="provincia" required>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="field">
                        <label class="label" for="distrito">Distrito <span class="has-text-danger">*</span></label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Ej: Bellavista" id="distrito" name="distrito" required>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <h2 class="title is-5 is-size-6-mobile mb-4">3. Contacto y Director</h2>
            <div class="columns is-multiline">
                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="telefono">Teléfono</label>
                        <div class="control has-icons-left">
                            <input class="input" type="tel" placeholder="(+51) 987 654 321" id="telefono" name="telefono">
                            <span class="icon is-small is-left"><i class="fas fa-phone"></i></span>
                        </div>
                    </div>
                </div>
                
                <div class="column is-half">
                    <div class="field">
                        <label class="label" for="email">Email Institucional <span class="has-text-danger">*</span></label>
                        <div class="control has-icons-left">
                            <input class="input" type="email" placeholder="contacto@colegio.edu.pe" id="email" name="email" required>
                            <span class="icon is-small is-left"><i class="fas fa-envelope"></i></span>
                        </div>
                    </div>
                </div>

                <div class="column is-full">
                    <div class="field">
                        <label class="label" for="director">Nombre del Director/a <span class="has-text-danger">*</span></label>
                        <div class="control has-icons-left">
                            <input class="input" type="text" placeholder="Lic. María Torres" id="director" name="director" required>
                            <span class="icon is-small is-left"><i class="fas fa-user-tie"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <hr class="mt-4">

            <div class="columns is-mobile is-centered is-multiline vertical-buttons" style="margin-top: 40px;">
                <div class="column is-full-mobile is-half-tablet is-one-third-desktop has-text-centered">
                    <div class="control">
                        <button class="button is-primary is-large is-fullwidth" type="submit">
                            <span class="icon is-medium"><i class="fas fa-check-circle"></i></span>
                            <span>Guardar Registro</span>
                        </button>
                    </div>
                </div>
                <div class="column is-full-mobile is-half-tablet is-one-third-desktop has-text-centered">
                    <div class="control">
                        <button class="button is-light is-large is-fullwidth" type="reset">
                            <span class="icon is-medium"><i class="fas fa-times-circle"></i></span>
                            <span>Cancelar</span>
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    // URL del endpoint de Flask. Asegúrate que Flask esté corriendo en este puerto.
    const URL_BACKEND = 'http://127.0.0.1:5000/colegios'; 

    document.addEventListener('DOMContentLoaded', () => {
        // Obtenemos el formulario
        const form = document.querySelector('form');
        
        // Asignar 100 puntos por defecto (solo para ejemplo visual)
        document.getElementById('userPoints').textContent = '100 Pts'; 

        // Escuchamos el evento de envío del formulario
        form.addEventListener('submit', manejarEnvioFormulario);
    });

    /**
     * Intercepta el envío del formulario, extrae los datos y los envía al backend.
     * @param {Event} event - El evento de envío del formulario.
     */
    async function manejarEnvioFormulario(event) {
        event.preventDefault(); // Evita que el formulario se envíe de forma tradicional (recarga de página)
        
        // Desactivar el botón para evitar doble envío
        const submitButton = event.target.querySelector('button[type="submit"]');
        submitButton.classList.add('is-loading');

        try {
            // Recolectar datos del formulario
            const datosDelFormulario = {
                codigo_modular_r: document.getElementById('codigo').value,
                nombre_colegio: document.getElementById('nombre').value,
                tipo_gestion: document.getElementById('tipo_colegio').value, // 'publico' o 'privado'
                direccion_comple: document.getElementById('direccion').value,
                departamento: document.getElementById('departamento').value,
                provincia: document.getElementById('provincia').value,
                distrito: document.getElementById('distrito').value,
                telefono: document.getElementById('telefono').value || null, // Opcional
                email_institucion: document.getElementById('email').value,
                nombre_director: document.getElementById('director').value
            };
            
            console.log("Datos a enviar:", datosDelFormulario);

            const respuesta = await fetch(URL_BACKEND, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(datosDelFormulario),
            });

            // Verificar si la respuesta fue exitosa (código 201 en tu backend)
            if (respuesta.ok) {
                const resultado = await respuesta.json();
                
                // Mostrar alerta de éxito
                alert(`✅ Registro exitoso! ID: ${resultado.id_colegio} - ${resultado.mensaje}`);
                
                // Opcional: Limpiar el formulario después del éxito
                event.target.reset();
                
            } else {
                // Si hay un error (ej. 400 por campos faltantes o 500 interno)
                const errorData = await respuesta.json();
                throw new Error(errorData.error || `Error HTTP: ${respuesta.status}`);
            }

        } catch (error) {
            console.error('❌ Error en la conexión/registro:', error);
            alert(`Error al registrar el colegio:\n${error.message}`);
            
        } finally {
            // Quitar el estado de carga del botón al finalizar
            submitButton.classList.remove('is-loading');
        }
    }
</script>
</body>
</html>
