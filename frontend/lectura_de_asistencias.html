<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Control de Asistencias</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v6.4.2/js/all.js"></script>
    <style>

        /* Estilos de la barra de t√≠tulo moderna (Degradado MORADO/AZUL) */
        .page-header {
            margin-bottom: 2rem;
            /* Degradado morado/azul */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border-radius: 0; 
            padding: 2rem;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .page-header .title,
        .page-header .subtitle {
            color: white !important;
        }

        .page-header .icon-text {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        /* 1. ESTILOS GLOBALES */
        body {
            background-color: #f5f5f5;
            padding-top: 0; 
        }
        
        .main-content {
            padding-top: 0px;
            padding-bottom: 30px;
        }
        
        /* Ajuste de color del box de registro */
        .box.has-background-white-ter {
            background-color: white !important; 
            box-shadow: 0 0.5em 1em -0.125em rgba(10, 10, 10, 0.1), 0 0px 0 1px rgba(10, 10, 10, 0.02);
        }
        
        /* Color del bot√≥n principal (Mantenemos el verde menta) */
        .button.is-primary {
            background-color: #00d1b2; 
            border-color: transparent;
            color: #fff;
        }
        .button.is-primary:hover {
            background-color: #00b89c; 
        }

        /* Estilos para el bloque de estad√≠sticas (SOLO √çCONO) */
        .user-stats {
            background: rgba(255, 255, 255, 0.25);
            border-radius: 50px;
            padding: 0.75rem; 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px; 
            height: 50px;
        }
        .user-stats .icon {
            font-size: 1.6rem;
        }
        
        /* Estilos de Media Queries para el header en m√≥viles */
        @media screen and (max-width: 768px) {
            .page-header .level { display: block !important; text-align: center; }
            .page-header .level-left, .page-header .level-right { margin-bottom: 1rem; text-align: center; }
            .page-header .level-item { display: block; margin-bottom: 0.5rem; }
            .page-header .title.is-2 { font-size: 1.3rem; }
            .page-header .subtitle.is-5 { font-size: 0.95rem; }
            .page-header { padding: 1.25rem 1rem; }
            .level-right { 
                justify-content: center;
                display: flex; 
            }
        }

    </style>
</head>
<body>
    
    <div class="page-header">
        <div class="container">
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <div>
                            <h1 class="title is-2">
                                <span class="icon-text">
                                    <span class="icon has-text-white mr-3">
                                        <i class="fas fa-calendar-check fa-lg"></i>
                                    </span>
                                    <span>Registro de Control de Asistencias</span> 
                                </span>
                            </h1>
                            <p class="subtitle is-5 mt-2">EduGana</p>
                        </div>
                    </div>
                </div>
                
                <div class="level-right">
                    <div class="level-item">
                        <div class="user-stats">
                            <span class="icon">
                                <i class="fas fa-coins"></i> 
                            </span>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container main-content">
        <div class="columns">

            <div class="column is-one-third">
                <div class="box has-background-white-ter">
                    <h2 class="title is-5 has-text-centered">üë§ Registro de Control de Asistencias</h2>
                    <p class="subtitle is-7 has-text-centered mb-4">Ingresa el ID del **empleado/estudiante** para marcar asistencia.</p>

                    <form action="#" method="POST" id="asistencia-form"> <div class="field">
                            <label class="label" for="registro_id">ID *</label>
                            <div class="control has-icons-left">
                                <input class="input is-large" type="text" id="registro_id" name="registro_id" placeholder="Ej. A00123" required autofocus>
                                <span class="icon is-left">
                                    <i class="fas fa-id-card"></i>
                                </span>
                            </div>
                        </div>

                        <div class="field mt-5">
                            <div class="control">
                                <button class="button is-primary is-fullwidth" type="submit">
                                    <span class="icon"><i class="fas fa-clock"></i></span>
                                    <span>Marcar Asistencia</span>
                                </button>
                            </div>
                        </div>

                        <div class="field">
                            <div class="control">
                                <button class="button is-light is-fullwidth" type="reset">
                                    <span>Limpiar Campo</span>
                                </button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>

            <div class="column is-two-thirds">
                <div class="box">
                    <h2 class="title is-5 has-text-centered has-text-success">‚úÖ Asistencias del D√≠a</h2>
                    
                    <div class="field has-addons mb-4">
                        <div class="control has-icons-left is-expanded">
                            <input class="input" type="text" id="filtro-busqueda" placeholder="Buscar por Nombre o ID...">
                            <span class="icon is-left"><i class="fas fa-search"></i></span>
                        </div>
                        <div class="control">
                            <div class="select">
                                <select id="filtro-estado">
                                    <option value="todos">Mostrar todos</option>
                                    <option value="Presente">Entrada</option>
                                    <option value="Salida">Salida</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table is-striped is-hoverable is-fullwidth">
                            
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre Completo</th>
                                    <th><abbr title="ID">ID</abbr></th>
                                    <th><abbr title="Estado">Estado</abbr></th>
                                    <th>Hora</th>
                                </tr>
                            </thead>
                            
                            <tbody id="asistencia-body">
                                <tr data-id="A00123" data-estado="Presente">
                                    <td>1</td>
                                    <td>Ana Luc√≠a Flores</td>
                                    <td>A00123</td>
                                    <td><span class="tag is-success">Presente</span></td>
                                    <td>07:58 AM</td>
                                </tr>
                                <tr data-id="C00456" data-estado="Tarde">
                                    <td>2</td>
                                    <td>Carlos Miguel P√©rez</td>
                                    <td>C00456</td>
                                    <td><span class="tag is-warning">Tarde</span></td>
                                    <td>08:10 AM</td>
                                </tr>
                                <tr data-id="D00789" data-estado="Ausente">
                                    <td>3</td>
                                    <td>Diana Sof√≠a Herrera</td>
                                    <td>D00789</td>
                                    <td><span class="tag is-danger">Ausente</span></td>
                                    <td>-</td>
                                </tr>
                                <tr data-id="E01011" data-estado="Salida">
                                    <td>4</td>
                                    <td>Ernesto G√≥mez Paz</td>
                                    <td>E01011</td>
                                    <td><span class="tag is-info">Salida</span></td>
                                    <td>05:05 PM</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

<script>
    // ==========================================================
    // L√ìGICA DE ASISTENCIAS (JavaScript)
    // ==========================================================

    // 1. Obtener elementos clave del DOM
    const formRegistro = document.getElementById('asistencia-form');
    const inputID = document.getElementById('registro_id');
    const tablaCuerpo = document.getElementById('asistencia-body');
    
    // Funci√≥n para obtener la hora actual en formato HH:MM XM
    function obtenerHoraActual() {
        const ahora = new Date();
        return new Intl.DateTimeFormat('es-US', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        }).format(ahora);
    }

    // Funci√≥n para simular la b√∫squeda de nombre
    function buscarNombrePorID(id) {
        // Simulaci√≥n de una "base de datos" simple con algunos nombres de ejemplo
        const datosUsuarios = {
            'A00123': 'Ana Luc√≠a Flores',
            'C00456': 'Carlos Miguel P√©rez',
            'D00789': 'Diana Sof√≠a Herrera',
            'E01011': 'Ernesto G√≥mez Paz',
            'F01234': 'Fabiola Garc√≠a' // Nuevo para pruebas
        };
        // Devuelve el nombre si existe, o un nombre gen√©rico si no
        return datosUsuarios[id] || `Usuario ${id} (Nuevo)`;
    }

    // Manejar el env√≠o del formulario (Marcar Asistencia)
    formRegistro.addEventListener('submit', function(event) {
        event.preventDefault(); // Previene el env√≠o por defecto de la p√°gina

        const idIngresado = inputID.value.trim().toUpperCase();
        
        if (idIngresado.length === 0) {
            alert('Por favor, ingresa un ID.');
            return;
        }

        const nombre = buscarNombrePorID(idIngresado);
        const hora = obtenerHoraActual();
        
        // Determinar el estado (Entrada/Salida) y el color
        let estadoTag;
        let estadoTexto;
        
        // 1. Obtener todas las filas de la tabla
        const filasActuales = Array.from(tablaCuerpo.children);
        
        // 2. Filtrar las filas de hoy que coinciden con el ID y que son Presente/Tarde (Entrada)
        // Nota: En un sistema real, no buscar√≠as en la tabla visible, sino en la fuente de datos.
        const entradasExistentes = filasActuales.filter(row => {
            const rowID = row.querySelector('td:nth-child(3)').textContent;
            const rowEstado = row.querySelector('.tag').textContent;
            return rowID === idIngresado && (rowEstado === 'Presente' || rowEstado === 'Tarde');
        });
        
        // 3. Filtrar las salidas existentes
         const salidasExistentes = filasActuales.filter(row => {
            const rowID = row.querySelector('td:nth-child(3)').textContent;
            const rowEstado = row.querySelector('.tag').textContent;
            return rowID === idIngresado && rowEstado === 'Salida';
        });


        if (entradasExistentes.length > salidasExistentes.length) {
            // Existe una entrada pero no una salida reciente. Se marca como Salida.
            estadoTexto = 'Salida';
            estadoTag = 'is-info';
        } else {
            // No hay entradas, o la √∫ltima marca fue una Salida. Se marca como Entrada.
            estadoTexto = 'Presente'; 
            estadoTag = 'is-success';
        }

        // 4. Calcular el nuevo n√∫mero de registro (recontar despu√©s de filtrar filas de ejemplo est√°ticas si las hay)
        // Para simplificar, simplemente usamos el n√∫mero total de filas + 1, aunque en un sistema real esto lo manejar√≠a el backend.
        const numRegistros = tablaCuerpo.children.length + 1;


        // 5. Crear la nueva fila (<tr>) para la tabla
        const nuevaFila = document.createElement('tr');
        nuevaFila.setAttribute('data-id', idIngresado); // A√±adir data-id para futuras b√∫squedas
        nuevaFila.setAttribute('data-estado', estadoTexto);
        
        nuevaFila.innerHTML = `
            <td>${numRegistros}</td>
            <td>${nombre}</td>
            <td>${idIngresado}</td>
            <td><span class="tag ${estadoTag}">${estadoTexto}</span></td>
            <td>${hora}</td>
        `;

        // 6. Insertar la nueva fila al inicio de la tabla (el registro m√°s reciente primero)
        tablaCuerpo.prepend(nuevaFila);

        // 7. Limpiar el campo de entrada
        inputID.value = '';
        inputID.focus();

        // Muestra una notificaci√≥n temporal de √©xito
        alert(`‚úÖ Asistencia de ${nombre} marcada a las ${hora} como ${estadoTexto}.`);
        
        // Re-numerar las filas despu√©s de insertar una nueva (opcional, para mantener el # en orden)
        renumerarFilas();
    });
    
    // Funci√≥n para re-numerar las filas de la tabla
    function renumerarFilas() {
        const filas = tablaCuerpo.querySelectorAll('tr');
        filas.forEach((fila, index) => {
            // El n√∫mero es la cantidad total de filas menos el √≠ndice actual
            fila.querySelector('td:first-child').textContent = filas.length - index;
        });
    }

    // Inicializar la numeraci√≥n al cargar
    document.addEventListener('DOMContentLoaded', renumerarFilas);
    
</script>

</body>
</html>